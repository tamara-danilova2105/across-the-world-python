# Reviews Analysis API

API-сервис для анализа пользовательских отзывов с использованием NLP-моделей.
Сервис агрегирует данные из MongoDB, определяет тональность отзывов и выделяет основные темы.

---

## Назначение проекта

Проект предназначен для:
- анализа тональности отзывов (positive / neutral / negative)
- выделения ключевых тем в тексте отзывов
- предоставления агрегированной статистики и детализированных данных через HTTP API

Подходит для аналитики, админ-панелей, CRM и внутренних инструментов.

---

## Используемые технологии

- Python 3.10+
- FastAPI — HTTP API
- Uvicorn — ASGI сервер
- MongoDB — источник отзывов
- transformers (HuggingFace) — NLP модели
- python-dotenv — загрузка переменных окружения

---

## Архитектура проекта

```
.
├── main.py               # точка входа FastAPI
├── routers/              # HTTP-роутеры
│   └── analysis.py       # эндпоинты анализа отзывов
├── services/             # бизнес-логика и ML
│   ├── sentiment.py      # анализ тональности
│   └── topics.py         # анализ тем
├── db/
│   └── mongo.py          # подключение к MongoDB
├── venv/
├── .env                  # переменные окружения
└── README.md
```

---

## Как работает система

### Поток данных

1. Клиент отправляет GET-запрос на эндпоинт анализа
2. API получает отзывы из MongoDB
3. Для каждого отзыва:
   - определяется тональность текста
   - выделяются основные темы
4. Данные агрегируются и возвращаются клиенту

---

## MongoDB

Источник данных — коллекция отзывов в MongoDB.

### Используемые поля документа

- feedback — текст отзыва
- name — имя пользователя
- city — город
- isModeration — признак одобренного отзыва
- createdAt — дата создания

Подключение выполняется через переменные окружения.

---

## NLP: Анализ тональности

Модуль: services/sentiment.py

Используется модель:
- blanchefort/rubert-base-cased-sentiment

Что делает:
- принимает текст отзыва
- возвращает:
  - label: positive | neutral | negative
  - score: уверенность модели

Модель оптимизирована под русский язык.

---

## NLP: Анализ тем

Модуль: services/topics.py

Используется zero-shot классификация:
- MoritzLaurer/mDeBERTa-v3-base-mnli-xnli

Поддерживает многоязычные тексты без дообучения.

Предопределённые темы:
- еда
- гид
- маршрут
- логистика
- проживание

Модель возвращает темы с вероятностью выше 0.2.

---

## API

### GET /reviews/analysis

Возвращает агрегированную статистику и детальную информацию по отзывам.

Пример ответа:
- общее количество отзывов
- количество позитивных / нейтральных / негативных
- список отзывов с тональностью и темами

---

## Swagger

После запуска сервера Swagger доступен по адресу:

http://127.0.0.1:8000/docs

---

## Запуск проекта

1. Активировать виртуальное окружение

Windows:
    venv\Scripts\Activate.ps1

macOS / Linux:
    source venv/bin/activate

2. Установить зависимости

    pip install -r requirements.txt

3. Запустить сервер

    uvicorn main:app --reload

---

## Переменные окружения (.env)

Пример:

MONGO_URI=mongodb://localhost:27017
MONGO_DB=reviews
MONGO_COLLECTION=reviews

---

## Примечания

- Проект ориентирован на внутреннее использование
- Модели загружаются при старте приложения
- Возможна высокая нагрузка на CPU при большом объёме данных
